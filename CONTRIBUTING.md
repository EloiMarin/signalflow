# Contributing

## Creating a new Node

- Create the .h header file in the appropriate subdirectory of `source/include/signal/node`
- Create the .cpp source file in the appropriate subdirectory of `source/src/node`
- Add the header file to `source/include/signalflow/signalflow.h`
- Add the source file to `source/src/CMakeLists.txt`
- Regenerate the auto-generated Python bindings: `auxiliary/scripts/generate-node-python-bindings.py > source/src/python/nodes.cpp`
- Add unit tests to the appropriate test script in `tests`
- Re-run the tests: `python3 setup.py test`
- Update the stubs (see below)

## Build: C++

To build with debug symbols:
```
cmake -DCMAKE_BUILD_TYPE=Debug ..
```

## Build: Python

To build the Python libraries with debug symbols:
```
python3 setup.py build --debug install
# TODO: How to do this with pip?
```

## Test

To run the unit test suite:
```
python3 setup.py test
```

## Release

For each new release:

- Update the version in `setup.py`
- Add entry to `CHANGELOG.md`
- Commit changes
- Add a git version tag, in format `v1.2.34`
- Add a GitHub release with title `v1.2.34`, using the latest `CHANGELOG` entry as the release body 
- Build new wheels:
  - Linux x86: wheels are automatically built using GitHub actions
  - Linux rpi: wheels must be built manually using `auxiliary/cibuildwheel/make-raspberry-pi-aarch64.sh`
  - macOS: wheels must be built manually using `auxiliary/cibuildwheel/make-macos-x86-arm64.sh`
  - Windows: wheels must be built manually (TBC)
- Upload wheels to pypi: `twine upload wheelhouse/1.2.34/*`

## Documentation

To update autogenerated Node documentation:

```
auxiliary/scripts/generate-node-python-bindings.py --markdown > docs/library/index.md
```

To generate and serve the docs:

```
pip3 install mkdocs mkdocs-material mkdocs-include-markdown-plugin mkdocs-git-revision-date-localized-plugin
mkdocs serve
```

To deploy docs to GitHub:
```
mkdocs gh-deploy
```

### Generating stubs

To generate [stubs](https://peps.python.org/pep-0561/) for IDE type hinting and inline documentation, the [pybind11-stubgen](https://github.com/sizmailov/pybind11-stubgen) package is required. Once installed, run:

```
pybind11-stubgen -o auxiliary/libs/signalflow-stubs signalflow
```

The `signalflow-stubs` package is bundled with the standard SignalFlow wheel, and as per [PEP 561's convention for stub-only packages](https://peps.python.org/pep-0561/#stub-only-packages), should be used by IDEs to display type hints and docs. This has been verified in Visual Studio Code 1.84.1.
